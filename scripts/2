from lxml import etree
from PIL import Image

class XMLCropper:

    def __init__(self, xml_path):
        self.tree = etree.parse(xml_path)
        self.data = self._parse()

    def _parse(self):
        result = {
            'folder':   self.tree.find('folder').text,
            'filename': self.tree.find('filename').text,
            'path':     self.tree.find('path').text,
            'items':    [],
        }
        for obj in self.tree.xpath('/annotation/object'):
            bndbox = obj.find('bndbox')
            item = {
                'label':    obj.find('name').text,
                'xmin':     int(bndbox.find('xmin').text),
                'ymin':     int(bndbox.find('ymin').text),
                'xmax':     int(bndbox.find('xmax').text),
                'ymax':     int(bndbox.find('ymax').text),
            }
            result['items'].append(item)
        return result

    #def crop(self, dest_dir):
        #img = Image.open(self.data.path)
        #crop = image.crop((  ))

    def crop(self, dest_dir):
        for item in self.data.items:
            print(item)

if __name__ == "__main__":

    import sys
    from pprint import pprint as pp

    xml_path = sys.argv[1]
    out_path = sys.argv[2]

    cropper = XMLCropper(xml_path)
    pp(cropper.crop(out_path))
